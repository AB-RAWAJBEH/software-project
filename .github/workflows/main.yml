name: GitHub Actions Maven Build Example 

on:
  push:
      branches: [master]
jobs:

  build-on-ubuntu:

      runs-on: ubuntu-latest
      steps:
         - name: Step1 - Checkout main branch from GitHub 
           uses: actions/checkout-java@v2
            
        
         - name: Step 2 - Set up JDK 1.11
           uses: actions/setup-java@v1
           with: 
              java-version: 19.0.2

              
         - name: Step3 - Build Maven Project 
           run: mvn -e -X --batch-mode -DskipTests package

           
         - name: Step4 - Run test cases
           run: mvn --batch-mode -Dmaven.test.failure.ignore=true test
      name: SonarCloud 
      on:
       push:
         branches:
          -master
       pull_request:
         types: [opened,synchronize,reopened]
      jobs:
        build:
          name: Build and analyze 
          runs-on: ubuntu-latest
          steps:
            -uses: actions/checkout@v3
            with: 
              fetch-depth: 0 #Shallow clones should be disabled for a better relevancy of analysis 
            -name: Set up JDK 17
            uses: actions/setup-java@v3
          with: 
               java-version: 17
               distribution: 'zulu'# Alternative distribution option are available.

          -name: Cache SonarCloud packages 
          uses: actions/setup-java@v3
        with: 
               path: ~/.sonar/cache
               key: ${{runner.os}}-sonar
               restore-key:  ${{runner.os}}-sonar
               
        -name: Cache Maven packages 
      uses: actions/setup-java@v3
  with: 
                path: ~/.m2
                key: ${{runner.os}}-m2-${{hashFiles('**/pom.xml')}}
                restore-key:  ${{runner.os}}-m2
            -name: Build and analyze
              evn:
               GITHUB_TOKEN: ${{secrets.SONAR_TOKEN}}# Needed to get PRinformation,if any
               SONAR_TOKEN:  ${{secrets.SONAR_TOKEN}}
              run: mvn -B verify org.sonarsource.scanner.maven:sonar--maven-plugin:sonar-Dsonar.projectKey=AB-RAWAJBEH_software-project
